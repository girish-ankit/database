SELECT
  *
 
FROM iocl.IOCL_ROUTE_DEVIATIONS_NEW
WHERE IRD_DEV_DUR_IN_MINS>=5
AND IRD_IS_DONE =0 AND IRD_DEV_END_AT >= DATE_ADD(CURDATE(), INTERVAL -1 DAY) AND IRD_DEV_END_AT < DATE_ADD(CURDATE(), INTERVAL -0 DAY) ORDER BY IRD_ID DESC;


SELECT DISTINCT IAC_IID_VEHICLE_ID FROM iocl.IOCL_ALLIDLE_CLOSEDTRIPS WHERE IAC_IID_TRIP_ACTUAL_END_TIME >= DATE_ADD(CURDATE(), INTERVAL -1 DAY) AND IAC_IID_TRIP_ACTUAL_END_TIME < DATE_ADD(CURDATE(), INTERVAL -0 DAY) AND TIMESTAMPDIFF(SECOND,IAC_TMP_IDLE_START_TIME,IAC_TMP_IDLE_END_TIME)/60>=5;

SELECT DISTINCT IAC_IID_VEHICLE_ID FROM iocl.IOCL_ALLIDLE_CLOSEDTRIPS WHERE IAC_IID_TRIP_FORCE_CLOSED_TIME >= DATE_ADD(CURDATE(), INTERVAL -1 DAY) AND IAC_IID_TRIP_FORCE_CLOSED_TIME < DATE_ADD(CURDATE(), INTERVAL -0 DAY) AND TIMESTAMPDIFF(SECOND,IAC_TMP_IDLE_START_TIME,IAC_TMP_IDLE_END_TIME)/60>=5;



(
SELECT DISTINCT d.IRD_VEH_ID FROM iocl.IOCL_ROUTE_DEVIATIONS_NEW d WHERE d.IRD_DEV_DUR_IN_MINS>=5
AND d.IRD_IS_DONE =0 AND d.IRD_DEV_END_AT >= DATE_ADD(CURDATE(), INTERVAL -1 DAY) 
AND d.IRD_DEV_END_AT < DATE_ADD(CURDATE(), INTERVAL -0 DAY)
)
INTERSECT                    
(
SELECT DISTINCT c.IAC_IID_VEHICLE_ID FROM iocl.IOCL_ALLIDLE_CLOSEDTRIPS c 
WHERE c.IAC_IID_TRIP_ACTUAL_END_TIME >= DATE_ADD(CURDATE(), INTERVAL -1 DAY) 
AND c.IAC_IID_TRIP_ACTUAL_END_TIME < DATE_ADD(CURDATE(), INTERVAL -0 DAY)
);



SELECT DISTINCT d.IRD_VEH_ID FROM iocl.IOCL_ROUTE_DEVIATIONS_NEW d  JOIN iocl.IOCL_ALLIDLE_CLOSEDTRIPS c  ON d.IRD_VEH_ID = c.IAC_IID_VEHICLE_ID  WHERE d.IRD_DEV_DUR_IN_MINS>=5
AND d.IRD_IS_DONE =0 AND d.IRD_DEV_END_AT >= DATE_ADD(CURDATE(), INTERVAL -1 DAY) 
AND d.IRD_DEV_END_AT < DATE_ADD(CURDATE(), INTERVAL -0 DAY) AND c.IAC_IID_TRIP_ACTUAL_END_TIME >= DATE_ADD(CURDATE(), INTERVAL -1 DAY) 
AND c.IAC_IID_TRIP_ACTUAL_END_TIME < DATE_ADD(CURDATE(), INTERVAL -0 DAY);


SELECT d.* FROM iocl.IOCL_ROUTE_DEVIATIONS_NEW d  JOIN iocl.IOCL_ALLIDLE_CLOSEDTRIPS c  ON d.IRD_VEH_ID = c.IAC_IID_VEHICLE_ID  WHERE d.IRD_DEV_DUR_IN_MINS>=5
AND d.IRD_IS_DONE =0 AND d.IRD_DEV_END_AT >= DATE_ADD(CURDATE(), INTERVAL -1 DAY) 
AND d.IRD_DEV_END_AT < DATE_ADD(CURDATE(), INTERVAL -0 DAY) AND c.IAC_IID_TRIP_ACTUAL_END_TIME >= DATE_ADD(CURDATE(), INTERVAL -1 DAY) 
AND c.IAC_IID_TRIP_ACTUAL_END_TIME < DATE_ADD(CURDATE(), INTERVAL -0 DAY) order by d.IRD_TRIP_ID desc;


SELECT DISTINCT d.IRD_TRIP_ID FROM iocl.IOCL_ROUTE_DEVIATIONS_NEW d  JOIN iocl.IOCL_ALLIDLE_CLOSEDTRIPS c  ON d.IRD_VEH_ID = c.IAC_IID_VEHICLE_ID  WHERE d.IRD_DEV_DUR_IN_MINS>=5
AND d.IRD_IS_DONE =0 AND d.IRD_DEV_END_AT >= DATE_ADD(CURDATE(), INTERVAL -1 DAY) 
AND d.IRD_DEV_END_AT < DATE_ADD(CURDATE(), INTERVAL -0 DAY) AND c.IAC_IID_TRIP_ACTUAL_END_TIME >= DATE_ADD(CURDATE(), INTERVAL -1 DAY) 
AND c.IAC_IID_TRIP_ACTUAL_END_TIME < DATE_ADD(CURDATE(), INTERVAL -0 DAY);


invoice data:

SELECT * FROM iocl.IOCL_INVOICE_DATA WHERE IID_SUPPLY_PLANT_CODE IN (
SELECT DISTINCT d.IRD_TRIP_ID FROM iocl.IOCL_ROUTE_DEVIATIONS_NEW d  JOIN iocl.IOCL_ALLIDLE_CLOSEDTRIPS c  ON d.IRD_VEH_ID = c.IAC_IID_VEHICLE_ID  WHERE d.IRD_DEV_DUR_IN_MINS>=5
AND d.IRD_IS_DONE =0 AND d.IRD_DEV_END_AT >= DATE_ADD(CURDATE(), INTERVAL -1 DAY) 
AND d.IRD_DEV_END_AT < DATE_ADD(CURDATE(), INTERVAL -0 DAY) AND c.IAC_IID_TRIP_ACTUAL_END_TIME >= DATE_ADD(CURDATE(), INTERVAL -1 DAY) 
AND c.IAC_IID_TRIP_ACTUAL_END_TIME < DATE_ADD(CURDATE(), INTERVAL -0 DAY)
) ORDER BY IID_SUPPLY_PLANT_CODE DESC;


get route status:

select * from IOCL_ROUTE_MST where IRM_ROUTE_ID in (
SELECT distinct IID_ROUTE_ID FROM iocl.IOCL_INVOICE_DATA WHERE IID_SUPPLY_PLANT_CODE IN (
SELECT DISTINCT d.IRD_TRIP_ID FROM iocl.IOCL_ROUTE_DEVIATIONS_NEW d  JOIN iocl.IOCL_ALLIDLE_CLOSEDTRIPS c  ON d.IRD_VEH_ID = c.IAC_IID_VEHICLE_ID  WHERE d.IRD_DEV_DUR_IN_MINS>=5
AND d.IRD_IS_DONE =0 AND d.IRD_DEV_END_AT >= DATE_ADD(CURDATE(), INTERVAL -1 DAY) 
AND d.IRD_DEV_END_AT < DATE_ADD(CURDATE(), INTERVAL -0 DAY) AND c.IAC_IID_TRIP_ACTUAL_END_TIME >= DATE_ADD(CURDATE(), INTERVAL -1 DAY) 
AND c.IAC_IID_TRIP_ACTUAL_END_TIME < DATE_ADD(CURDATE(), INTERVAL -0 DAY)
) ORDER BY IID_SUPPLY_PLANT_CODE DESC
);

