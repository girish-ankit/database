#1>
P:IOCL_PROC_EXCEPTION_SUMMARIZED_AV

TI: IOCL_TEMP_EXCEPTION_SUMMARIZED (TEMPORATY TABLE)
TF: IOCL_EXCEPTIONS_SCHEDULER_NEW

P: IOCL_FN_GET_VEHS

#2>.
P:IOCL_PROC_GET_LETTER_TO_TRANSPORTERS_WSE
TI: IOCL_LETTER_TO_TRANSPORTERS_NEW,ETRK_VEHICLE_MST,ETRK_PET_TRANSPORTER_MST

		
   T: IOCL_LETTER_TO_TRANSPORTERS_NEW  POPULATED BY 
   P: IOCL_PROC_GENERATE_LETTER_TO_TRANSPORTER_WITH_START_END

   >>> UPDATE ETRK_SUPPLY_LOC_MST SET ESLM_SERIAL_NO=LETTER_NO WHERE ESLM_SUPPLY_LOC_ID=TPT_SL_ID;

   TI: IOCL_LETTER_TO_TRANSPORTERS_NEW
   TF: IOCL_TEMP_LETTER_TO_TPTS_FULL(TEMPORARY TABLE) ==> P: IOCL_PROC_LETTER_TO_TPTS_NAME_NEW_FULL


   P: IOCL_PROC_LETTER_TO_TPTS_NAME_NEW_FULL
   TI: IOCL_TEMP_LETTER_TO_TPTS_FULL
   TF: IOCL_INVOICE_DATA

   QUERY:

   SELECT MN.IID_TRIP_ID,MN.IID_SUPPLY_PLANT,MN.IID_TRIP_STATUS,MN.IID_PERMISSABLE_HALT,MN.IID_ROUTE_DEV_LOC_ON_MAJOR,MN.IID_HALT_LOC_ON_MAJOR,MN.IID_HALT_DUR,MN.IID_ROUTE_DEV_DUR,MN.IID_INVOICE_DATE,MN.IID_TRIP_STATUS,DATEDIFF(NOW(),MN.IID_INVOICE_DATE),MN.IID_PARTY_NAME,MN.IID_SUPPLY_PLANT_CODE,MN.IID_VEHICLE_ID,MN.IID_VEHICLE_NO,
(SELECT IID_INVOICE_DATE 
FROM IOCL_INVOICE_DATA WHERE IID_TRIP_ID=MN.IID_TRIP_ID ORDER BY IID_INVOICE_DATE DESC LIMIT 1) 

FROM
(SELECT * 
FROM IOCL_INVOICE_DATA
WHERE IID_INVOICE_DATE>=str_to_date(pFROMDATE,'%d/%m/%Y %T') 
AND IID_INVOICE_DATE<=str_to_date(pTODATE,'%d/%m/%Y %T') 
AND IID_VEHICLE_ID IN 

(SELECT EVM_VEHICLE_ID 
FROM ETRK_VEHICLE_MST 
WHERE EVM_DEVICE_STATUS ='active' AND EVM_VEHICLE_STATUS = 'active' AND EVM_ISACTIVE = 1 AND EVM_SUPPLY_LOC_ID =pSUPPLYLOC_ID AND EVM_TRANSPORTER_ID=pTPT_ID
)

)MN;

       


